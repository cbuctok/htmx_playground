{% extends "base.html" %}

{% block title %}{% if mode == 'create' %}New User{% else %}Edit User{% endif %} - Admin - {{ super() }}{% endblock %}

{% block content %}
<div class="page-header">
    <a href="/admin/users" class="btn btn-link">&larr; Back to Users</a>
    <h2>{% if mode == 'create' %}Create New User{% else %}Edit User{% endif %}</h2>
</div>

<div class="form-container">
    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}

    <form
        method="post"
        action="/admin/users/{% if mode == 'create' %}new{% else %}{{ user.id }}/edit{% endif %}"
        hx-post="/admin/users/{% if mode == 'create' %}new{% else %}{{ user.id }}/edit{% endif %}"
        class="crud-form"
    >
        <div class="form-group">
            <label for="username">Username <span class="required">*</span></label>
            <input
                type="text"
                id="username"
                name="username"
                value="{{ user.username if user else '' }}"
                required
            >
        </div>

        <div class="form-group">
            <label for="password">
                Password
                {% if mode == 'create' %}<span class="required">*</span>{% endif %}
            </label>
            <input
                type="password"
                id="password"
                name="password"
                {% if mode == 'create' %}required{% endif %}
                placeholder="{% if mode == 'edit' %}Leave blank to keep current{% endif %}"
            >
            {% if mode == 'edit' %}
            <span class="field-hint">Leave blank to keep current password</span>
            {% endif %}
            <div class="alert alert-warning">
                Warning: Passwords are stored in plaintext (demo only!)
            </div>
        </div>

        <div class="form-group">
            <label for="role">Role <span class="required">*</span></label>
            <select id="role" name="role" required>
                <option value="user" {% if user and user.role == 'user' %}selected{% endif %}>User</option>
                <option value="admin" {% if user and user.role == 'admin' %}selected{% endif %}>Admin</option>
            </select>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if mode == 'create' %}Create User{% else %}Update User{% endif %}
            </button>
            <a href="/admin/users" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>
{% endblock %}
